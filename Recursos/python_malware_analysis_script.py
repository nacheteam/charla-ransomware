#!/usr/bin/python


# Rippped from analyse_malware.py written by beenudel1986[@]gmail[dot]com (awesome script)
# Original script can be found at: https://infosecaddictsfiles.blob.core.windows.net/files/analyse_malware.py
# Modified by Joe McCray to look for more stuff

# 5/24/2017 - still need to get the FSRM function working.....




import os,sys,re,string

def checkconfig():
	try:
		import pefile,peutils

	except(ImportError):
		print "\n[!] PE Module Missing."
		print "\n[!] For Debian/Ubuntu/Mint please run: sudo apt-get install -y python-pefile"
		print "\n[!] For RHEL/CentOS/Fedora please run: sudo yum install -y python-pefile"
		sys.exit(0)


# Say Hello

if sys.platform == 'linux-i386' or sys.platform == 'linux2' or sys.platform == 'darwin':
	SysCls = 'clear'
elif sys.platform == 'win32' or sys.platform == 'dos' or sys.platform[0:5] == 'ms-dos':
	SysCls = 'cls'
else:
	SysCls = 'unknown'

os.system(SysCls)



# Make some lists

# Need to fix this list from https://fsrm.experiant.ca/api/v1/combined - probably bad chars
# FSRM = ["wlu","Restore_maysomware_files.html","maysomware","damoclis","decrypter@tutanota.com","VisionCrypt","pwned","how_to_back_files.html","hNcrypt","~xdata~","b0ff","Galaperidol.exe","HOW_CAN_I_DECRYPT_MY_FILES.txt","xdata","Hello There! Fellow @kee User!.txt","kee","grux","Restore_your_files.txt","READ_ME.html","mordor","die","SaMsUnG","!#_DECRYPT_#!.inf","nuke55","onyon","blocked","!Please Read Me!.txt","!WannaDecryptor!.exe.lnk","DARKCRY","wincry","wncrypt","WannaCrypt 4.0.exe","t.wry","vCrypt1","theva","PAY","tor.exe","tasksche.exe","wcry.zip","taskhsvc.exe","taskse.exe","taskdl.exe","pky","eky","wcry.exe","Wannacry.exe","@WanaDecryptor@.","slvpawned","WCRYT","WRNY","LOCKED.txt","wncryt","wnry","viki","RESTORE-12345-FILES.TXT","donation1@protonmail.ch.12345","block_file12","@decrypt2017","vdul","2cXpCihgsVxB3","son","loptr-.htm","paycyka","medal","bagi","@Please_Read_Me@.txt","wncry","_!!!_README_!!!_","_!!!_README_!!!__.hta","_!!!_README_!!!__ .txt","news","corrupted","HOW_TO_DECRYPT_FILES.html","shifr","DECRYPT_INFO.txt","FailedAccess","Cversions.2.db","helppme@india.com.","ReadME_Decrypt_Help_.html","fartplz","\u041a\u0410\u041a_\u0420\u0410\u0421\u0428\u0418\u0424\u0420\u041e\u0412\u0410\u0422\u042c_\u0424\u0410\u0419\u041b\u042b.txt"," .vCrypt1","xncrypt","Lockify","htrs","cryptowin","owned","x0lzs3c","UIWIX","CRYPTOBOSS","loptr","jaff","bitkangoroo","cloud","zcrypt.exe","uk-dealer@sigaint.org","_luck","decrypt2017","admin@hoist.desi..WALLET","crysis@life.com..WALLET","SHIELD0@USA.COM..WALLET","#_RESTORING_FILES_#.TXT","haters","anon","amnesia","keepcalm","MIKOYAN","RESTORE_FILES.HTML","WWW","CRYPTED000007","HELPPME@INDIA.COM.ID83994902","HOW_RETURN_FILES.TXT","MAYA","CONTACT_TARINEOZA@GMAIL.COM","CRYPTOBYTE","AES","NOTE;!!!-ODZYSKAJ-PLIKI-!!!.TXT","INSTRUCTION_FOR_HELPING_FILE_RECOVERY.txt","ADR","NM4","DesktopOsiris.","OSIRIS-.","redchip2.exe","LOLI","ATLAS_FILES.txt","whatthefuck","loveyouisreal","okokokokok","ranranranran","READ_IT_FOR_GET_YOUR_FILE.txt","psh","GETREKT","one","!!! READ THIS - IMPORTANT !!!.txt","aes_ni_0day","JEEPERS","PAYMENT-INSTRUCTIONS.TXT","LOCKOUT","ATLAS","FLATCHER3@INDIA.COM.000G","AES-NI","DEXTER","CONFICKER","ONION","NO.TORP3DA@PROTONMAIL.CH.WALLET","LCKD","MOLE","RANSOM","lambda.l0cked","009-READ-FOR-DECCCC-FILESSS.html","_READ_THI$_FILE_","I'WANT MONEY","gembok","!Decrypt-All-Files-.txt","GOFMEN17@YA.RU,CRP","SERP","kilit","0_HELP_DECRYPT_FILES.HTM","HUR_DEKRYPTERA_FILER.html","HUR_DEKRYPTERA_FILER.txt","LAMBDA.LOCKED","ADMIN@BADADMIN.XYZ","SKJDTHGHH","LOCK75","B10CKED","A95436@YA.RU","IWANT","Fuck_You","Recupere seus arquivos aqui.txt","READ TO UNLOCK FILES.salsa..html","SALSA222","NUMBERDOT","How Decrypt My Files.lnk","How_Decrypt_My_Files","CRADLE","ID-7ES642406.CRY","READ ME ABOUT DECRYPTION.txt","Do_not_change_the_file_name.cryp","pr0tect","android","_READ_THIS_FILE__","btcware","drakosho_new@aol.com","AngleWare","zorro","CIFGKSAFFSFYGHD","A9V9AHU4","payfordecrypt","OKU.TXT","ZINO_NOTE.TXT","ZINO","kirked","CRPTXXX","HOW_TO_FIX_!.TXT","BRAINCRYPT@INDIA.COM.BRAINCRYPT","pizdec","REVENGE","!!!READ_TO_UNLOCK!!!.TXT","openforyou@india.com","warn_wallet","nemo-hacks.at.sigaint.org","MATRIX","Crytp0l0cker.Upack.dll","Crytp0l0cker.dll","Crytp0l0cker.exe","decrypted_files.dat","padcryptUninstaller.exe","PadCrypt.exe","Vape Launcher.exe","READ_ME_!.txt","enjey","Aescrypt.exe","GG","PINGY@INDIA.COM","WORMKILLER@INDIA.COM.XTBL","CEBER3","IF_WANT_FILES_BACK_PLS_READ.html","iaufkakfhsaraf","_HELP_HELP_HELP_","zXz.html","zXz","VictemKey__","HVORDAN_DU_GENDANNER_FILER.html","HVORDAN_DU_GENDANNER_FILER.txt","HELP_ME_PLEASE.txt","!_RECOVERY_HELP_!.txt","PLEASE-READIT-IF_YOU-WANT.html","filegofprencrp","COME_RIPRISTINARE_I_FILE.","fattura_.js","_steaveiwalker@india.com_","COMO_ABRIR_ARQUIVOS.txt","info@kraken.cc_worldcza@email.cz","kr3","COMO_RESTAURAR_ARCHIVOS.txt","COMO_RESTAURAR_ARCHIVOS.html","ENCR","File-Help@India.Com.mails","damage@india.com","tmp.exe","What happen to my files.txt","jeepdayz@india.com","BarRax","damage","locked-","jey","CRYPTOSHIEL","cfk","ASSISTANCE_IN_RECOVERY.txt","#_DECRYPT_ASSISTANCE_#.txt","lfk","_HELP_HELP_HELP_.hta","_HELP_HELP_HELP_.jpg","BTC_DECRYPT_FILES.txt","TheTrumpLockerp","TheTrumpLockerf","d4nk","x3mpro","READ-READ-READ.html","weencedufiles","jse","powned","KASISKI","INSTRUCCIONES.txt","@_USE_TO_FIX_.txt","happydayzz","hasp","001-READ-FOR-DECRYPT-FILES.html","DECRYPT_INFORMATION.html","Rans0m_N0te_Read_ME.txt","email-vpupkin3@aol.com","hnyear","hnumkhotep@india.com.hnumkhotep","wowwhereismyfiles","decryptional","wowreadfordecryp","7zipper","youransom","gui","Harzhuangzi","encryptedyourfiles","HERMES","amanda_sofost@india.com.wallet","wcry","velikasrbija","razarac","serpent","msj","szesnl","_DECRYPT_INFO_szesnl.html","000-IF-YOU-WANT-DEC-FILES.html","evillock","letmetrydecfiles","yourransom","lambda_l0cked","gefickt","HakunaMatata","CRYPTOSHIELD","weareyourfriends","MERRY_I_LOVE_YOU_BRUCE.hta","How decrypt files.hta","unCrypte@outlook.com","decipher_ne@outlook.com","potato","otherinformation","vxLock","rdmk","paytounlock","TRY-READ-ME-TO-DEC.html","EMAIL__recipient.zip","sage","garryweber@protonmail.ch","LEER_INMEDIATAMENTE.txt","killedXXX","doomed","sifreli","MERRY","000-No-PROBLEM-WE-DEC-FILES.html","noproblemwedecfiles","WE-MUST-DEC-FILES.html","powerfulldecrypt","stn","bingo@opensourcemail.org","id-3044989498_x3m","x3m","READ_ME_TO_DECRYPT_YOU_INFORMA.jjj","wuciwug","kencf","file0locked","file0locked.js","CryptoRansomware.exe","VBRANSOM","_HELP_Recover_Files_.html","oops","deria","RMCM1","Locked-by-Mafia","\u043a\u0438\u0431\u0435\u0440 \u0440\u0430\u0437\u0432\u0435\u0442\u0432\u0438\u0442\u0435\u043b\u044c","-filesencrypted.html","decrypt_Globe.exe","hnumkhotep","DecryptFile.txt","L0CKED","NFS-e1025-7152.exe","firstransomware.exe","HELP-ME-ENCED-FILES.html","helpmeencedfiles","EdgeLocker.exe","edgel","XBTL","firecrypt","YOUR_FILES_ARE_DEAD.hta","MRCR1","PEGS1","RARE1","airacropencrypted!","cryptsvc@mail.ru.","WHERE-YOUR-FILES.html","Whereisyourfiles","opentoyou@india.com","C-email--.odcodc","maktub","hush","bript","__README.hta","__README.jpg","HOW_OPEN_FILES.hta","gangbang","GJENOPPRETTING_AV_FILER.html","GJENOPPRETTING_AV_FILER.txt","!!! HOW TO DECRYPT FILES !!!.txt","braincrypt","INSTRUCTION RESTORE FILE.TXT","lesli","Survey Locker.exe","!!!!!ATEN\u00c7\u00c3O!!!!!.html","Receipt.exe","WindowsApplication1.exe","HWID Lock.exe","VIP72.exe","DALE_FILES.TXT","DALE","8637","kok","HOW_TO_RESTORE_YOUR_DATA.html","paymrts","paymds","RESTORE_CORUPTED_FILES.HTML","READ@My.txt","Cyber SpLiTTer Vbs.exe","flyper","000-PLEASE-READ-WE-HELP.html","helpdecrypt@india.com","VforVendetta","popcorn_time.exe","filock","wallet","_.rmd","uDz2j8mv","OSIRIS-.htm","DesktopOsiris.htm","cryptservice@inbox.ru","no_more_ransom","bahij2@india.com","lovewindows","osiris","R.i.P","Important!.txt","!_HOW_TO_RESTORE_.txt","HOW_TO_RESTORE_FILES.txt","_README_.hta","Zzzz","lavandos@dr.com.wallet","coin","crypted_file","EncrypTile","hcked","_README_.hta","Runsome.exe","Payment_Advice.mht","lblBitcoinInfoMain.txt","lblFinallyText.txt","lblMain.txt","hannah","vindows","How to decrypt your files.jpg","How to decrypt your files.txt","How to get data back.txt","zycrypt","sgood","zzzzz","xort.txt","DOSYALARINIZA ULA\u015eMAK \u0130\u00c7\u0130N A\u00c7INIZ.html","HOWTO_RECOVER_FILES_.TXT","HELP_RESTORE_FILES_.TXT","Recovery+.html","Recovery+.txt","_H_e_l_p_RECOVER_INSTRUCTIONS+.png","_H_e_l_p_RECOVER_INSTRUCTIONS+.html","help_recover_instructions+.html","help_recover_instructions+.BMP","_how_recover+.html","_how_recover+.txt","ThxForYurTyme.txt","_HOW_TO_Decrypt.bmp","_RECOVER_INSTRUCTIONS.ini","###-READ-FOR-HELLPP.html","rtext.txt","DECRYPTION INSTRUCTIONS.txt","decrypt explanations.html","_WHAT_is.html","_HOWDO_text.html","readme_liesmich_encryptor_raas.txt","_Adatok_visszaallitasahoz_utasitasok.txt","How to restore files.hta","locked.bmp","README_TO_RECURE_YOUR_FILES.txt","Your files encrypted by our friends !!!.txt","ATTENTION.url","@WARNING_FILES_ARE_ENCRYPTED..txt","README!!!.txt","# README.hta","!Recovery_.html","YourID.txt","recover.bmp","recover.txt","README HOW TO DECRYPT YOUR FILES.HTML","READ_IT.txt","lock93","!emc","adk","svchosd.exe","aesir","CHIP","happy","angelamerkel","razy1337","zendr4","dharma","locked3","duhust","exploit","_crypt","_help_instruct.","!DMAlock","GSupport3","rnsmwr","dCrypt","ransomed.html","Alcatraz","_WHAT_is.html","readme.hta","96e2","thor","dxxd","usr0","shit","coded","raid10","realfs0ciety","rip","okean","globe","nuclear55","1txt","kostya","k0stya","comrade","exotic","fuck","Yakes","Zimbra","email-salazar_slytherin10@yahoo.com.ver-.id--.randomname-","_AiraCropEncrypted!","README_RECOVER_FILES_.txt","README_RECOVER_FILES_.png","README_RECOVER_FILES_.html","~HL","Sarah_G@ausi.com___","zc3791","venusp","shino","bleepYourFiles","crashed","amba","7h9r","\u5df2\u52a0\u5bc6","\uc554\ud638\ud654\ub428","b5c6","ap19","a19","__HOWDO_text.html","_HOWDO_text.bmp","_HOWDO_text.html","odin","zypto","zzzzzzzzzzzzzzzzzyyy","zycrypt.","decrypt your file.","_nullbyte","bart","axx","_H_e_l_p_RECOVER_INSTRUCTIONS+.txt","HOW-TO-DECRYPT-FILES.HTML","HOW_TO_DECRYPT.HTML","exit.hhr.obleep","UnblockFiles.vbs","README_DECRYPT_HYDRA_ID_.txt","DECRYPT_Readme.TXT.ReadMe","Decrypt All Files .bmp","HowDecrypt.gif","HELP_YOURFILES.HTML","HOW TO DECRYPT FILES.HTML","BUYUNLOCKCODE","BitCryptorFileList.txt","crjocker","POSHKODER","hydracrypt_ID_","CTBL2","unbrecrypt_ID_","padcrypt","rekt","CCCRRRPPP","SecureCrypte","windows10","pdcr","keybtc@inbox","breaking_bad","cryptowall","xorist","crypt1","How_to_decrypt_your_files.jpg","How_to_restore_files.hta","cerber3","a5zfn","purge","fantom","cerber2","!readme.","Como descriptografar seus arquivos.txt","C0rp0r@c@0Xr@","domino","cerber2","cawwcca","how_to_unlock.","!Recovery_.txt","Read_this_file.txt","legion","encoderpass","cryptolocker","7z.encrypted","ATTENTION!!!.txt","HELP_DECRYPT.lnk","how to decrypt aes files.lnk","restore_files.txt","HowDecrypt.txt","$RECYCLE.BIN.{---}","heisenberg","breaking bad","razy","Venusf","~","payfornature@india.com.crypted","winclwp.jpg","wie_zum_Wiederherstellen_von_Dateien.txt","tox.html","strongcrypt.bmp","qwer2.html","qwer.html","pronk.txt","paycrypt.bmp","maxcrypt.bmp","how_decrypt.gif","how to get data.txt","help_recover_instructions.txt","help_recover_instructions.html","help_recover_instructions.bmp","help-file-decrypt.enc","enigma_encr.txt","enigma.hta","default432643264.jpg","default32643264.bmp","decypt_your_files.html","de_crypt_readme.txt","de_crypt_readme.html","de_crypt_readme.bmp","cryptinfo.txt","crjoker.html","_how_recover.txt","_how_recover.html","_Locky_recover_instructions.bmp","_H_e_l_p_RECOVER_INSTRUCTIONS.txt","_H_e_l_p_RECOVER_INSTRUCTIONS.png","_H_e_l_p_RECOVER_INSTRUCTIONS.html","_HELP_instructions.txt","_HELP_instructions.bmp","_DECRYPT_INFO_.html","Your files encrypted by our friends !!! txt","Your files are locked !.txt","Your files are locked !!.txt","Your files are locked !!!.txt","Your files are locked !!!!.txt","YOUR_FILES_ARE_LOCKED.txt","YOUR_FILES_ARE_ENCRYPTED.TXT","YOUR_FILES_ARE_ENCRYPTED.HTML","YOUGOTHACKED.TXT","UNLOCK_FILES_INSTRUCTIONS.txt","UNLOCK_FILES_INSTRUCTIONS.html","SIFRE_COZME_TALIMATI.html","SHTODELATVAM.txt","Read Me (How Decrypt) !!!!.txt","RESTORE_FILES_.txt","RESTORE_FILES_.","READ_THIS_TO_DECRYPT.html","README_HOW_TO_UNLOCK.TXT","README_HOW_TO_UNLOCK.HTML","README_DECRYPT_UMBRE_ID_.txt","README_DECRYPT_UMBRE_ID_.jpg","README_DECRYPT_HYRDA_ID_.txt","READ ME FOR DECRYPT.txt","READ IF YOU WANT YOUR FILES BACK.html","Payment_Instructions.jpg","ONTSLEUTELINGS_INSTRUCTIES.html","OKSOWATHAPPENDTOYOURFILES.TXT","MENSAGEM.txt","KryptoLocker_README.txt","Instructionaga.txt","ISTRUZIONI_DECRITTAZIONE.html","INSTRUCTIONS_DE_DECRYPTAGE.html","INSTRUCCIONES_DESCIFRADO.html","INSTALL_TOR.URL","IMPORTANT.README","IMPORTANT READ ME.txt","Howto_RESTORE_FILES.html","How to decrypt your data.txt","How to decrypt LeChiffre files.html","Help Decrypt.html","Hacked_Read_me_to_decrypt_files.html","HOW_TO_UNLOCK_FILES_README_.txt","HOW_TO_RESTORE_FILES.html","HOW_DECRYPT.URL","HOW_DECRYPT.TXT","HOW_DECRYPT.HTML","HOWTO_RECOVER_FILES_.","HOW TO DECRYPT FILES.txt","HELP_YOUR_FILES.html","HELP_YOUR_FILES.PNG","HELP_TO_SAVE_FILES.bmp","HELP_RESTORE_FILES_.","HELP_DECRYPT.URL","HELP_DECRYPT.PNG","HELP_DECRYPT.HTML","GetYouFiles.txt","File Decrypt Help.html","FILES_BACK.txt","ENTSCHLUSSELN_HINWEISE.html","DecryptAllFiles.txt","DESIFROVANI_POKYNY.html","DECRYPT_YOUR_FILES.txt","DECRYPT_YOUR_FILES.HTML","DECRYPT_ReadMe1.TXT","DECRYPT_INSTRUCTIONS.html","DECRYPT_INSTRUCTION.URL","DECRYPT_INSTRUCTION.HTML","DECRYPTION_HOWTO.Notepad","Comment d\u00e9bloquer mes fichiers.txt","BUYUNLOCKCODE.txt","AllFilesAreLocked.bmp","4-14-2016-INFECTION.TXT","_ryp","_HELP_instructions.html","xcrypt","unavailable","szf","porno.pornoransom","plauge17","neitrino","kimcilware.locked","iwanthelpuuu","herbst","helpdecrypt@ukr.net","h3ll","gws.porno","fuckyourdata","encrypted.locked","cryptz","crypttt","cripttt","criptokod","criptiko","btc.kkk.fun.gws","aga","_ryp","Where_my_files.txt","Read_Me.Txt","RSplited","KEYZ.KEYH0LES","How_To_Get_Back.txt","How_To_Decrypt.txt","Contact_Here_To_Recover_Your_Files.txt","31392E30362E32303136_","# DECRYPT MY FILES #.vbs","# DECRYPT MY FILES #.txt","# DECRYPT MY FILES #.html","!Where_are_my_files!.html","!!!README!!!.rtf","!!!-WARNING-!!!.txt","!!!-WARNING-!!!.html","magic_software_syndicate","maestro@pizzacrypts.info","crypt","bitstak","wflx","CRRRT","howtodecryptaesfiles.txt","!satana!.txt","akaibvn","cRh8","YTBL","krypted","tzu","6FKR8d","sshxkej","eclr","epic","paybtcs","AFD","paymst","payms","isis","zepto","bart.zip","kratos","31342E30362E32303136","SecureCrypted","crptrgr","rtyrtyrty","!DMALOCK3.0","evil","crypt38","asdasdasd","ded","bloccato","canihelpyou","crypz","decrypt-instruct.","files_are_encrypted.","decryptmyfiles.","help_instructions.","-recover-.","de_crypt_readme.","!recover!.","recover}-.","rec0ver.","_help_instruct.","_recover_.","+recover+.","warning-!!.","decrypt my file.","help_file_.","recovery+.","readme_for_decrypt.","install_tor.","readme_decrypt.","howtodecrypt.","howto_restore.","how_to_recover.","how_recover.","how_to_decrypt.","how to decrypt.","help_restore.","help_your_file.","help_recover.","help_decrypt.","decrypt_instruct.","cryptolocker.","recover_instruction.","hydracrypt_ID","gmail.crypt","cryptotorlocker","xxx","xyz","xtbl","xort","xrtn","vvv","vscrypt","trun","ttt","surprise","troyancoder@qq_com","sport","scl","ryp","sanction","RRK","rokku","remind","relock@qq_com","RDM","RADAMANT","R5A","R4A","PoAr2w","pizda@qq_com","p5tkjw","oplata@qq_com","oshit","oor","one-we_can-help_you","OMG!","nochance","nalog@qq_com","micro","LOL!","locky","locked","LeChiffre","kraken","korrektor","kkk","kimcilware","KEYZ","keybtc@inbox_com","KEYHOLES","justbtcwillhelpyou","infected","helpdecrypt@ukr_net","hb15","ha3","gruzin@qq_com","gws","fun","fucked","enigma","encryptedped","encryptedRSA","encryptedAES","Encrypted","encrypt","encedRSA","EnCiPhErEd","dyatel@qq_com","czvxce","darkness","ctbl","CrySiS","CryptoTorLocker2015!","crypted","cry","crjoker","crinf","crime","coverton","code","clf","chifrator@qq_com","cerber","cbf","btcbtcbtc","btc-help-you","btc","bloc","better_call_saul","AES256","{CRYPTENDBLACKDC}","73i87A","zzz","abc","aaa","vault.txt","vault.key","recovery_key.txt","vault.hta","message.txt","recovery_file.txt","confirmation.key","enc_files.txt","last_chance.txt","vault","want your files back.","frtrss","exx","ezz","ecc","help_restore.","how_to_recover.","restore_fi.","ukr.net","qq_com","keemail.me","decipher","install_tor.","@india.com","@gmail_com_","obleep","exx","locked","nochance","kraken","kb15","darkness","crypto","cry","_Locky_recover_instructions.txt","help_recover_instructions+.txt","recoverfile.txt","Howto_Restore_FILES.TXT","recoveryfile.txt","_how_recover.txt","howrecover+.txt","restorefiles.txt","howto_recover_file.txt","HowtoRESTORE_FILES.txt","RECOVERY_FILE.txt","RECOVERY_FILES.txt","help_decrypt_your_files.html","HELPDECYPRT_YOUR_FILES.HTML","IHAVEYOURSECRET.KEY","SECRET.KEY","SECRETIDHERE.KEY","READTHISNOW!!!.TXT","IAMREADYTOPAY.TXT","HELLOTHERE.TXT","FILESAREGONE.TXT","DECRYPT_ReadMe.TXT","Read.txt","About_Files.txt","_secret_code.txt","ReadDecryptFilesHere.txt","Coin.Locker.txt","HOW_TO_DECRYPT_FILES.TXT","DECRYPT_INSTRUCTION.TXT","encryptor_raas_readme_liesmich.txt","Help_Decrypt.txt","YOUR_FILES.url","How_To_Recover_Files.txt","YOUR_FILES.HTML","INSTRUCCIONES_DESCIFRADO.TXT","DECRYPT_INSTRUCTIONS.TXT","HELP_TO_SAVE_FILES.txt","DecryptAllFiles.txt","HELP_RECOVER_FILES.txt","HELP_RESTORE_FILES.txt","HELP_TO_DECRYPT_YOUR_FILES.txt","HELP_YOUR_FILES.TXT","HELPDECRYPT.TXT","CTB2","SUPERCRYPT","magic","1999","toxcrypt","bleep","0x0","good","R16M01D05","pzdc","XRNT","crypto","ccc","da_vinci_code","payransom","KEYH0LES","oor.","zyklon","zcrypt","Z81928819","Silent","RSNSlocked","RAD","porno","pornoransom","odcodc","_ryp","helpdecrypt@ukr.net","only-we_can-help_you","cryp1","fileiscryptedhard","blocatto","8lock8","777"]

Uses_Microsoft_Enhanced_Cryptographic_Provider = ["CryptReleaseContext","CryptExportKey","CryptGetKeyParam","GlobalAlloc","CryptEncrypt","GlobalFree","CryptDestroyKey","CryptImportKey"]

RemoteAccess = ["malloc","memset","htons","socket","bind","closesocket","listen","CreateThread","accept","Sleep","free","listen","__stack_chk_fail","^([01]?\d\d?|2[0-4]\d|25[0-5])\.([01]?\d\d?|2[0-4]\d|25[0-5])\.([01]?\d\d?|2[0-4]\d|25[0-5])\.([01]?\d\d?|2[0-4]\d|25[0-5])","ws2_32.bind","ws2_32.listen","ws2_32.htons"]

Uses_IRC =["IRC","Joined channel","Port","BOT","Login","flood","ddos","NICK","ECHO","PRIVMSG","ADMIN","AWAY","CONNECT","KICK","LIST","MODE","MOTD","PING","PONG","QUIT","SERVLIST","SERVICE","NAMES","JOIN","INVITE","INFO","TRACE","USERHOST","WHO","WHOIS","VERSION"]

REGISTRY_CALLS =["HKEY_CURRENT_USER","HKEY_CLASSES_ROOT","HKEY_LOCAL_MACHINE","autorum.inf"]

UPX =["UPX0","UPX1","UPX2","UPX3","ABC0","ABC1","ABC2","ABC3","ABC4"]

EnumerateListFiles = ["lstrcat","Sleep","lstrcpy","CharLowerA","strstr","lstrlen","memset","FindFirstFileA","FindNextFileA","FindClose"]

AntiDebugging = ["GetProcessHeap","RtlAllocateHeap","socket","htons","select","memset","recv","htons","HeapFree","closesocket","IsDebuggerPresent","OutputDebugString"]

INTERESTING_DLLS=["KERNEL32.DLL","advapi32.dll","comctl32.dll","gdi32.dll","ole32.dll","oleaut32.dll","user32.dll","wsock32.dll","ntdll.dll"]

PrivEscalation = ["DuplicateTokenEx","ImpersonateNamedPipeClient","RevertToSelf","signal"]

INTERESTING_CALLS_DLLS=["KERNEL32.DLL","advapi32.dll","comctl32.dll","gdi32.dll","ole32.dll","oleaut32.dll","user32.dll","wsock32.dll","ntdll.dll"]

if (len (sys.argv) <2):
	print "\n Usage: ./analyse_malware.py <MALWARE FILENAME>\n"
	print "\t\t Example: ./analyse_malware.py malware.exe\n"
	print "\tFor Help: ./analyse_malware.py --help\n"
	sys.exit(0)

for arg in sys.argv:
	if arg=='--help':
		print "   To Perform Complete Analysis: Usage: ./analyse_malware.py [Malware FIle]\n "
		print "   To Generate ASCII Dump: Usage: ./analyse_malware.py [Malware File] --Ascii\n"
		print "   To View Dlls Loaded: Usage: ./analyse_malware.py [Malware File] --Dll\n"
		print "   To View the PE Areas: Usage: ./analyse_mwlare.py [Malware File] --Header\n"
		print "\n\t   Example: ./analyse_malware.py malware.exe --Dll\n"
		sys.exit(0)
	


malware=sys.argv[1]

try:
	hosts= open(malware,'r').readlines()
except (IOError):
	print " \n\n[!]Malware Missing .Exiting.\n"
	sys.exit(0)

	
def start_analysis_fsrm():
	performed=[]
	for line in hosts:
		for string in FSRM:
			if re.search(string, line):
				if not string in performed:
					print "[+] Found an artifact from fsrm.experiant.ca: ",string
					performed.append(string)
					
					
	
def start_analysis_crypto():
	performed=[]
	for line in hosts:
		for string in Uses_Microsoft_Enhanced_Cryptographic_Provider:
			if re.search(string, line):
				if not string in performed:
					print "[+] This file uses Microsoft Enhanced Cryptographic Provider: ",string
					performed.append(string)
					

					
def start_analysis_network_aware():
	performed=[]
	for line in hosts:
		for calls in RemoteAccess:
			if re.search(calls, line):
				if not calls in performed:
					print "[+] This file is network aware as noted by:",calls
					performed.append(calls)	
			

					
def start_analysis_irc():
	performed=[]
	for line in hosts:
		for calls in Uses_IRC:
			if re.search(calls, line):
				if not calls in performed:
					print "[+] Malware Seems to be IRC BOT: Verified By String :",calls
					performed.append(calls)					

	
def start_analysis_upx():
	performed=[]
	for line in hosts:
		for string in UPX:
			if re.search(string, line):
				if not string in performed:
					print "[+] This file appears to be packed with the infamous UPX packer: ",string
					performed.append(string)
		
					
	
def start_analysis_antidebugging():
	performed=[]
	for line in hosts:
		for string in AntiDebugging:
			if re.search(string, line):
				if not string in performed:
					print "[+] This file appears to make use of Anti-Debugging techniques: ",string
					performed.append(string)
					

					
def start_analysis_privilege_escalation():
	performed=[]
	for line in hosts:
		for calls in PrivEscalation:
			if re.search(calls, line):
				if not calls in performed:
					print "[+] This file appears to be capable of privilege escalation:",calls
					performed.append(calls)	
				

					
def start_analysis_irc():
	performed=[]
	for line in hosts:
		for calls in Uses_IRC:
			if re.search(calls, line):
				if not calls in performed:
					print "[+] Malware Seems to be IRC BOT: Verified By String :",calls
					performed.append(calls)	

					

def start_analysis_registry():
	for line in hosts:
		for calls in REGISTRY_CALLS:
			if re.search(calls, line):
				print "[+] Malware is Adding a Key at Hive: ",calls
				print line

				
def calls_to_dlls():
	if sys.platform == 'linux-i386' or sys.platform == 'linux2' or sys.platform == 'darwin':
		str="objdump -x "+malware+" | grep DLL >result"
		#print str
		print "\n Since Host OS is Linux. Peforming Deeper Analysis\n"
		details=os.system(str)
		dllresult=open('result','r').readlines()
		print "\n   [+] Dlls Loaded are:\n"
		for line in dllresult:
			print line
		os.system("rm result")
	else:
		for line in hosts:
			for calls in INTERESTING_CALLS_DLLS:
				if re.search(calls, line):
					print "\n[+] Loaded Dll: ",calls
										
def find_import_table():
	str="objdump -x "+malware+"  | grep \"import table\" >impresult"
	os.system(str)
	importresult=open('impresult','r').readlines()
	for line in importresult:
		print line
	os.system("rm impresult")

def start_address():
	str="objdump -x "+malware+"  | grep \"start address\" >startresult"
	os.system(str)
	stresult=open('startresult','r').readlines()
	for line in stresult:
		print line
	os.system("rm startresult")

def header_info():
	str="objdump -h "+malware+" >header"
	os.system(str)
	headresult=open('header','r').readlines()
	for line in headresult:
		print line
	os.system("rm header")

def generate_dump():
	str="objdump -s "+malware+" >ascii_dump"
	os.system(str)
	headresult=open('ascii_dump','r').readlines()
	for line in headresult:
		print line

			
					
def getSignatureForPe(pe):
	try:
		signatures = peutils.SignatureDatabase(PE_SIGNATURE_PATH)
		return signatures.match_all(pe)
	except:
		print ""

		
def get_pe_signature():
	try:
		pe = pefile.PE(malware)
		signatureInfo = getSignatureForPe(pe)
		peInfo = pe.dump_info()
		print peInfo
	except:
		print ""


def generate_dump():
	filename="ascii_dump_"+malware+".txt"
	str="objdump -s "+malware+" > "+filename
	os.system(str)
	headresult=open(filename,'r').readlines()
	for line in headresult:
		print line
	print "\n Check "+filename+" for the ASCII dump output"
	raw_input("\n Press <Enter> to Exit.\n")
	sys.exit(0)



def checkPE():
	print "\n Analysing if PE file...\n"
	check = file(malware, "rb")
	buff = check.read(2)
	check.close()
	if buff == "MZ":
		print "\n[+] Valid PE file."
		print "\n[+] Malware File Size :" , (os.path.getsize(malware))/1000 ,"KB"
	else: 
		print "[!] Not a Valid PE File. Exiting.!\n"
		sys.exit(0)

def checkargs():
	for arg in sys.argv:
			if arg.lower()=="--ascii":
				if sys.platform == 'linux-i386' or sys.platform == 'linux2' or sys.platform == 'darwin':
					checkPE()
					generate_dump()
					sys.exit(0)
				else:
					print "\n This Analysis is Applicable on Linux OS only"
					sys.exit(0)
	
			if arg.lower()=="--dll":
				if sys.platform == 'linux-i386' or sys.platform == 'linux2' or sys.platform == 'darwin':
					checkPE()
					calls_to_dlls()
					sys.exit(0)
				else :
					print "\n This Analysis is Applicable on Linux OS only"
					sys.exit(0)
	
			if arg.lower()=="--header":
				if sys.platform == 'linux-i386' or sys.platform == 'linux2' or sys.platform == 'darwin':
					checkPE()
					header_info()
					sys.exit(0)
				else :
					print "\n This Analysis is Applicable on Linux OS only"
					sys.exit(0)
		

def apps_start():
	checkconfig()
	checkPE()
	checkargs()
	# print "\n[!] Checking to see if the file contains artifacts from fsrm.experiant.ca.\n"
	# start_analysis_fsrm()
	
	print "\n[!] Checking to see if the file uses Microsoft Enhanced Cryptographic Provider\n"
	start_analysis_crypto()

	print "\n\n[!] Checking to see if the file is network aware.\n"
	start_analysis_network_aware()
	
	print "\n\n[!] Checking to see if the file interacts with IRC.\n"
	start_analysis_irc()	

	print "\n[!] Displaying Registry Hives Edited.\n"
	start_analysis_registry()

	print "\n[!] Checking to see if it is packed with UPX.\n"
	start_analysis_upx()
	
	
	print "\n[!] Checking to see if it uses anti-debugging.\n"
	start_analysis_antidebugging()
	
	print "\n[!] Checking to see if the file is capable of Privilege Escalation\n"
	start_analysis_privilege_escalation()
	
	print "\n\n[!] Displaying the Loaded DLLs.\n"
	calls_to_dlls()
	
	
	print "\n\n[!] Displaying the Headers of the Malware.\n"
	get_pe_signature()	
	
	if sys.platform == 'linux-i386' or sys.platform == 'linux2' or sys.platform == 'darwin':
		print "\n[+] Displaying Address of Import Table\n"
		find_import_table()
		print "\n[+] Displaying the Start Address\n"
		start_address()
		print "\n[+] Displaying the Header Sections and File Format"
		header_info()


	


apps_start()